# Lazy load nvm
declare -a NODE_GLOBALS=(`find ~/.nvm/versions/node -maxdepth 3 -type l -wholename '*/bin/*' | xargs -n1 basename | sort | uniq`)

NODE_GLOBALS+=("node")
NODE_GLOBALS+=("nvm")
NODE_GLOBALS+=("code")

load_nvm () {
    export NVM_DIR=~/.nvm
    [ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"

    declare -a NODE_GLOBAL_PACKAGES=("eslint" "gulp" "bunyan")
    for npmpackage in "${NODE_GLOBAL_PACKAGES[@]}"; do
        if [ ! -f "$(which ${npmpackage})" ]; then
            echo "Installing ${npmpackage} globally"
            eval "npm i -g ${npmpackage}"
        fi
    done
}

for cmd in "${NODE_GLOBALS[@]}"; do
    eval "${cmd}(){ unset -f ${NODE_GLOBALS}; load_nvm; ${cmd} \$@ }"
done
